<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Analyzing Surveys with R | SWAG Workshops Repository</title>
  <meta name="description" content="Chapter 6 Analyzing Surveys with R | SWAG Workshops Repository" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Analyzing Surveys with R | SWAG Workshops Repository" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Analyzing Surveys with R | SWAG Workshops Repository" />
  
  
  

<meta name="author" content="UW Statistical Workshops and Applications Group" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="smoothing-techniques.html"/>
<link rel="next" href="introduction-to-causal-inference.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SWAG Workshops Repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="chapter2.html"><a href="chapter2.html"><i class="fa fa-check"></i><b>2</b> Sampling-Resampling Methods</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter2.html"><a href="chapter2.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="chapter2.html"><a href="chapter2.html#rejection-sampling"><i class="fa fa-check"></i><b>2.2</b> Rejection Sampling</a></li>
<li class="chapter" data-level="2.3" data-path="chapter2.html"><a href="chapter2.html#sampling-resampling-methods"><i class="fa fa-check"></i><b>2.3</b> Sampling-Resampling Methods</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="chapter2.html"><a href="chapter2.html#overview-of-the-sampling-importance-resampling-algorithm"><i class="fa fa-check"></i><b>2.3.1</b> Overview of the Sampling-Importance-Resampling Algorithm</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter2.html"><a href="chapter2.html#computational-considerations"><i class="fa fa-check"></i><b>2.3.2</b> Computational Considerations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="chapter2.html"><a href="chapter2.html#implementation-of-sampling-resampling-methods"><i class="fa fa-check"></i><b>2.4</b> Implementation of Sampling-Resampling Methods</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="chapter2.html"><a href="chapter2.html#illustrative-example-with-binary-data"><i class="fa fa-check"></i><b>2.4.1</b> Illustrative Example with Binary Data</a></li>
<li class="chapter" data-level="2.4.2" data-path="chapter2.html"><a href="chapter2.html#practical-considerations-for-choosing-proposal-distributions"><i class="fa fa-check"></i><b>2.4.2</b> Practical Considerations for Choosing Proposal Distributions</a></li>
<li class="chapter" data-level="2.4.3" data-path="chapter2.html"><a href="chapter2.html#comparing-proposal-distributions"><i class="fa fa-check"></i><b>2.4.3</b> Comparing Proposal Distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="chapter2.html"><a href="chapter2.html#sampling-resampling-in-multiple-dimensions"><i class="fa fa-check"></i><b>2.5</b> Sampling-Resampling in Multiple Dimensions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="chapter2.html"><a href="chapter2.html#exercise-with-illustrative-example"><i class="fa fa-check"></i><b>2.5.1</b> Exercise with Illustrative Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html"><i class="fa fa-check"></i><b>3</b> Bernstein-von Mises Theorem</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#bayesian-inference"><i class="fa fa-check"></i><b>3.1.1</b> Bayesian Inference</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#theorem"><i class="fa fa-check"></i><b>3.2</b> Theorem</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#importance"><i class="fa fa-check"></i><b>3.2.1</b> Importance</a></li>
<li class="chapter" data-level="3.2.2" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#required-assumptions"><i class="fa fa-check"></i><b>3.2.2</b> Required Assumptions</a></li>
<li class="chapter" data-level="3.2.3" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#example-1---normal-normal-model"><i class="fa fa-check"></i><b>3.2.3</b> Example 1 - Normal-normal model</a></li>
<li class="chapter" data-level="3.2.4" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#example-2---bernoulli-beta-model"><i class="fa fa-check"></i><b>3.2.4</b> Example 2 - Bernoulli-Beta Model</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#limitations"><i class="fa fa-check"></i><b>3.3</b> Limitations</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#other-thoughts-on-consistency"><i class="fa fa-check"></i><b>3.3.1</b> Other thoughts on consistency</a></li>
<li class="chapter" data-level="3.3.2" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#example-3---prior-has-zero-density-at-theta_0"><i class="fa fa-check"></i><b>3.3.2</b> Example 3 - Prior has zero density at <span class="math inline">\(\theta_0\)</span></a></li>
<li class="chapter" data-level="3.3.3" data-path="bernstein-von-mises-theorem.html"><a href="bernstein-von-mises-theorem.html#example-4---true-parameter-value-is-on-the-boundary"><i class="fa fa-check"></i><b>3.3.3</b> Example 4 - True parameter value is on the boundary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="variational-inference.html"><a href="variational-inference.html"><i class="fa fa-check"></i><b>4</b> Variational Inference</a>
<ul>
<li class="chapter" data-level="4.1" data-path="variational-inference.html"><a href="variational-inference.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="variational-inference.html"><a href="variational-inference.html#frequentist-setting"><i class="fa fa-check"></i><b>4.1.1</b> Frequentist Setting</a></li>
<li class="chapter" data-level="4.1.2" data-path="variational-inference.html"><a href="variational-inference.html#bayesian-setting"><i class="fa fa-check"></i><b>4.1.2</b> Bayesian Setting</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="variational-inference.html"><a href="variational-inference.html#example-mixture-of-gaussians"><i class="fa fa-check"></i><b>4.2</b> Example: Mixture of Gaussians</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="variational-inference.html"><a href="variational-inference.html#coordinate-ascent-mean-field-variational-inference"><i class="fa fa-check"></i><b>4.2.1</b> Coordinate Ascent Mean-Field Variational Inference</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="variational-inference.html"><a href="variational-inference.html#example-stochastic-variational-inference-using-pyro-in-python"><i class="fa fa-check"></i><b>4.3</b> Example: Stochastic Variational Inference using Pyro in Python</a></li>
<li class="chapter" data-level="4.4" data-path="variational-inference.html"><a href="variational-inference.html#takeaways"><i class="fa fa-check"></i><b>4.4</b> Takeaways</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html"><i class="fa fa-check"></i><b>5</b> Smoothing Techniques</a>
<ul>
<li class="chapter" data-level="5.1" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#kernel-smoothing-methods"><i class="fa fa-check"></i><b>5.2</b> Kernel Smoothing Methods</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#local-linear-regression"><i class="fa fa-check"></i><b>5.2.1</b> Local linear regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#tuning-parameter-bandwidth-selection"><i class="fa fa-check"></i><b>5.2.2</b> Tuning Parameter (bandwidth) Selection</a></li>
<li class="chapter" data-level="5.2.3" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#extension-and-example-local-logistic-regression"><i class="fa fa-check"></i><b>5.2.3</b> Extension and example: Local logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#smoothing-spline"><i class="fa fa-check"></i><b>5.3</b> Smoothing Spline</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#computation-1"><i class="fa fa-check"></i><b>5.3.1</b> Computation</a></li>
<li class="chapter" data-level="5.3.2" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#tuning-parameter-selection"><i class="fa fa-check"></i><b>5.3.2</b> Tuning Parameter Selection</a></li>
<li class="chapter" data-level="5.3.3" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#extension-and-example-nonparametric-logistic-regression"><i class="fa fa-check"></i><b>5.3.3</b> Extension and example: Nonparametric logistic regression</a></li>
<li class="chapter" data-level="5.3.4" data-path="smoothing-techniques.html"><a href="smoothing-techniques.html#take-home-note"><i class="fa fa-check"></i><b>5.3.4</b> Take-home note</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html"><i class="fa fa-check"></i><b>6</b> Analyzing Surveys with R</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#acknowlegdements"><i class="fa fa-check"></i><b>6.1</b> Acknowlegdements</a></li>
<li class="chapter" data-level="6.2" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#introduction-to-thinking-about-surveys"><i class="fa fa-check"></i><b>6.2</b> Introduction to Thinking About Surveys</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#total-survey-error-tse"><i class="fa fa-check"></i><b>6.2.1</b> Total Survey Error (TSE)</a></li>
<li class="chapter" data-level="6.2.2" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#probability-vs.-non-probability-surveys"><i class="fa fa-check"></i><b>6.2.2</b> Probability vs. Non-Probability Surveys</a></li>
<li class="chapter" data-level="6.2.3" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#design-based-vs.-model-based-inference"><i class="fa fa-check"></i><b>6.2.3</b> Design-based vs. Model-based Inference</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#probability-survey-without-non-response-design-based"><i class="fa fa-check"></i><b>6.3</b> Probability Survey without Non-response (design-based)</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#some-notation"><i class="fa fa-check"></i><b>6.3.1</b> Some notation</a></li>
<li class="chapter" data-level="6.3.2" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#horvitz-thompson-estimator"><i class="fa fa-check"></i><b>6.3.2</b> Horvitz-Thompson Estimator</a></li>
<li class="chapter" data-level="6.3.3" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#variance-estimation"><i class="fa fa-check"></i><b>6.3.3</b> Variance Estimation</a></li>
<li class="chapter" data-level="6.3.4" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#simple-random-sampling-without-replacement-srswor"><i class="fa fa-check"></i><b>6.3.4</b> Simple Random Sampling Without Replacement (SRSwor)</a></li>
<li class="chapter" data-level="6.3.5" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#stratified-simple-random-sampling-without-replacement-ssrswor"><i class="fa fa-check"></i><b>6.3.5</b> Stratified Simple Random Sampling Without Replacement (SSRSwor)</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#post-adjustment-model-assisted"><i class="fa fa-check"></i><b>6.4</b> Post-adjustment (model-assisted)</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#post-stratification"><i class="fa fa-check"></i><b>6.4.1</b> Post-stratification</a></li>
<li class="chapter" data-level="6.4.2" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#calibration-dealing-with-multiple-auxilliary-variables"><i class="fa fa-check"></i><b>6.4.2</b> Calibration: Dealing with multiple auxilliary variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#what-makes-a-good-calibration-variable"><i class="fa fa-check"></i><b>6.4.3</b> What makes a good calibration variable?</a></li>
<li class="chapter" data-level="6.4.4" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#variance-estimation-resampling"><i class="fa fa-check"></i><b>6.4.4</b> Variance Estimation: Resampling</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="analyzing-surveys-with-r.html"><a href="analyzing-surveys-with-r.html#non-probability-surveys-model-based"><i class="fa fa-check"></i><b>6.5</b> Non-probability Surveys (model-based)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html"><i class="fa fa-check"></i><b>7</b> Introduction to Causal Inference</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#basic-concepts"><i class="fa fa-check"></i><b>7.1</b> Basic Concepts</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#notation"><i class="fa fa-check"></i><b>7.1.1</b> Notation</a></li>
<li class="chapter" data-level="7.1.2" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#causal-effect"><i class="fa fa-check"></i><b>7.1.2</b> Causal Effect</a></li>
<li class="chapter" data-level="7.1.3" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#assumptions"><i class="fa fa-check"></i><b>7.1.3</b> Assumptions</a></li>
<li class="chapter" data-level="7.1.4" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#propensity-score"><i class="fa fa-check"></i><b>7.1.4</b> Propensity Score</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#commonly-used-methods"><i class="fa fa-check"></i><b>7.2</b> Commonly Used Methods</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#matching"><i class="fa fa-check"></i><b>7.2.1</b> Matching</a></li>
<li class="chapter" data-level="7.2.2" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#stratification"><i class="fa fa-check"></i><b>7.2.2</b> Stratification</a></li>
<li class="chapter" data-level="7.2.3" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#inverse-probability-weighting"><i class="fa fa-check"></i><b>7.2.3</b> Inverse Probability Weighting</a></li>
<li class="chapter" data-level="7.2.4" data-path="introduction-to-causal-inference.html"><a href="introduction-to-causal-inference.html#doubly-robust-estimation"><i class="fa fa-check"></i><b>7.2.4</b> Doubly Robust Estimation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pooled-p-values.html"><a href="pooled-p-values.html"><i class="fa fa-check"></i><b>8</b> Pooled p-values</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pooled-p-values.html"><a href="pooled-p-values.html#a-motivating-example"><i class="fa fa-check"></i><b>8.1</b> A motivating example</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="pooled-p-values.html"><a href="pooled-p-values.html#some-real-data"><i class="fa fa-check"></i><b>8.1.1</b> Some “real” data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="pooled-p-values.html"><a href="pooled-p-values.html#pooling-p-values"><i class="fa fa-check"></i><b>8.2</b> Pooling <span class="math inline">\(p\)</span>-values</a></li>
<li class="chapter" data-level="8.3" data-path="pooled-p-values.html"><a href="pooled-p-values.html#adjusting-for-dependence"><i class="fa fa-check"></i><b>8.3</b> Adjusting for dependence</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="pooled-p-values.html"><a href="pooled-p-values.html#the-wrong-way"><i class="fa fa-check"></i><b>8.3.1</b> The wrong way</a></li>
<li class="chapter" data-level="8.3.2" data-path="pooled-p-values.html"><a href="pooled-p-values.html#a-better-way"><i class="fa fa-check"></i><b>8.3.2</b> A better way</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="pooled-p-values.html"><a href="pooled-p-values.html#take-aways"><i class="fa fa-check"></i><b>8.4</b> Take aways</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SWAG Workshops Repository</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyzing-surveys-with-r" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Analyzing Surveys with R<a href="analyzing-surveys-with-r.html#analyzing-surveys-with-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Gradon Nicholls</em></p>
<div id="acknowlegdements" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Acknowlegdements<a href="analyzing-surveys-with-r.html#acknowlegdements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Much of this workshop was informed by the book “Practical tools for designing and weighting survey samples” <span class="citation">(Valliant, Dever, and Kreuter 2013)</span>, which is the survey practitioner’s bible.</p>
<p>The standard reference on calibration: <span class="citation">(Deville, Särndal, and Sautory 1993)</span></p>
<p>I’ve also made use of course notes from STAT 332 offered by UWaterloo.</p>
<p>There is also <a href="https://r-survey.r-forge.r-project.org/survey/example-design.html">this webpage</a> on specifying survey designs in R.</p>
</div>
<div id="introduction-to-thinking-about-surveys" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Introduction to Thinking About Surveys<a href="analyzing-surveys-with-r.html#introduction-to-thinking-about-surveys" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="total-survey-error-tse" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Total Survey Error (TSE)<a href="analyzing-surveys-with-r.html#total-survey-error-tse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="figure">
<img src="TSEframework.png" alt="" />
<p class="caption">The Total Survey Error (TSE) Framework <span class="citation">(taken from Groves and Lyberg 2010)</span></p>
</div>
<p>TSE is divided into two parts:</p>
<ul>
<li>Errors of <em>Measurement</em>: Does the question wording capture the underlying concept?
Does the question wording affect how it is answered? Are there psychological processes
that cause respondents to give biased answers?</li>
<li>Errors of <em>Representation</em>: Do our survey respondents “look like” the population we are interested in?</li>
</ul>
<p>For this, we focus on errors of representation, which involve the following groups:</p>
<ul>
<li><em>Target Population</em>: The population which we would like to infer something about.</li>
<li><em>Sampling Frame</em>: A list of addresses/phone numbers/etc. from which we will draw our sample.</li>
<li><em>Sample</em>: The subset of the sampling frame which we will attempt to recruit to our survey,</li>
<li><em>Respondents</em>: Those in the sample who agree to complete our survey.</li>
</ul>
<p>TSE allows us to consider total error in our survey estimates as a sequential series
of errors. Much of survey research is devoted to zeroing on each type of error
to study its causes and potential solutions. The types of errors of representation are:</p>
<ul>
<li><em>Coverage Error</em>: Does our frame cover the entire target population?</li>
<li><em>Sampling Error</em>: Error caused by how we draw the sample. In a probability survey, this is generally the only portion we have full control over.</li>
<li><em>Nonresponse Error</em>: Do those who agree to our survey differ from tose who don’t respond?</li>
</ul>
</div>
<div id="probability-vs.-non-probability-surveys" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Probability vs. Non-Probability Surveys<a href="analyzing-surveys-with-r.html#probability-vs.-non-probability-surveys" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <em>probability survey</em> is one where everyone in the sampling frame has a known
and non-zero probability of being included in the sample. For example,
we have a list of all addresses in Canada, and we take a random sample of addresses
for our study.</p>
<p>A <em>non-probability survey</em> is one where such an inclusion probability is not known.
For example, we take out ads on websites recruiting participants to join our
<em>opt-in panel</em>. In this case we have no way of knowing how likely it is that each
member of the target population makes it into our panel.</p>
</div>
<div id="design-based-vs.-model-based-inference" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Design-based vs. Model-based Inference<a href="analyzing-surveys-with-r.html#design-based-vs.-model-based-inference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><em>Design-based</em>: rely fully on the sampling design</li>
<li><em>Model-assisted</em>: sampling design is the basis (e.g. probability survey with model for non-response)</li>
<li><em>Model-based</em>: rely fully on a model (e.g. calibration weights in a non-probability survey)</li>
</ul>
</div>
</div>
<div id="probability-survey-without-non-response-design-based" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Probability Survey without Non-response (design-based)<a href="analyzing-surveys-with-r.html#probability-survey-without-non-response-design-based" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="some-notation" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Some notation<a href="analyzing-surveys-with-r.html#some-notation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><span class="math inline">\(i\)</span>: a member of the population</li>
<li><span class="math inline">\(U\)</span>: the set of all members of the population</li>
<li><span class="math inline">\(S\)</span>: our randomly drawn sample</li>
<li><span class="math inline">\(I_i = I(i \in S)\)</span>: inclusion indicator</li>
<li><span class="math inline">\(\pi_i = \Pr(i \in S)\)</span>: inclusion probability</li>
<li><span class="math inline">\(\pi_{ij} = \Pr(i,j \in S)\)</span>: joint inclusion probability</li>
<li><span class="math inline">\(n\)</span>: sample size</li>
<li><span class="math inline">\(N\)</span>: population size</li>
</ul>
</div>
<div id="horvitz-thompson-estimator" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Horvitz-Thompson Estimator<a href="analyzing-surveys-with-r.html#horvitz-thompson-estimator" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s say we are interested in estimating <span class="math inline">\(\mu_U\)</span>, the population total. I.e.
<span class="math inline">\(\mu_U = \sum\limits_{i \in U} y_i\)</span>. Taking a census would be too expensive,
so instead we want to use a weighted average from our sample data:
<span class="math inline">\(\hat \mu = (1/N)\sum\limits_{i \in S} w_i y_i\)</span>. <em>Question:</em> <strong>how do we select <span class="math inline">\(w_i\)</span>
such that our estimate is unbiased?</strong></p>
<p><span class="math display">\[
\begin{aligned}
&amp;\text{we desire that }E[\hat \mu] = \mu_U \\
\implies&amp; E\left[\frac{1}{N}\sum_{i \in S} w_i y_i\right] = \mu_U \\
\implies&amp; E\left[\frac{1}{N}\sum_{i \in U} I_i w_i y_i\right] = \mu_U \\
\implies&amp; \frac{1}{N}\sum_{i \in U} E[I_i] w_i y_i = \mu_U \\
\implies&amp; \frac{1}{N}\sum_{i \in U} \pi_i w_i y_i = \mu_U \\
\implies&amp; \frac{1}{N}\sum_{i \in U} \pi_i w_i y_i = \frac{1}{N}\sum_{i \in U} y_i \\
\implies&amp; \text{we should set } w_i = 1/\pi_i
\end{aligned}
\]</span></p>
<p>By setting <span class="math inline">\(w_i = 1/\pi_i\)</span>, we have derived the <em>Horvitz-Thompson estimator</em>.
In words, HT tells us to weight each sample observation by the inverse of their
inclusion probability.</p>
<p>To get the HT estimator of the mean, we simply divide by <span class="math inline">\(N\)</span>. I.e.
<span class="math inline">\(\hat \mu = \frac{1}{N}\sum_{i \in S} (1/\pi_i) y_i\)</span>.</p>
</div>
<div id="variance-estimation" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Variance Estimation<a href="analyzing-surveys-with-r.html#variance-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most generally, the variance of the HT estimator for the total is,</p>
<p><span class="math display">\[
\text{Var}(\hat t) = \sum_{i \in U} \pi_i(1-\pi_i) \left(\frac{y_i}{\pi_i}\right)^2 + \sum_{i,j \in U; i \neq j} (\pi_{ij} - \pi_i\pi_j)\frac{y_i}{\pi_i}\frac{y_j}{\pi_j}
\]</span></p>
<p>which we can in principle estimate using our sample data. Notice that it relies on
joint inclusion probailities <span class="math inline">\(\pi_{ij}\)</span>!</p>
</div>
<div id="simple-random-sampling-without-replacement-srswor" class="section level3 hasAnchor" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Simple Random Sampling Without Replacement (SRSwor)<a href="analyzing-surveys-with-r.html#simple-random-sampling-without-replacement-srswor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We select <span class="math inline">\(n\)</span> individuals from a population of <span class="math inline">\(N\)</span> completely at random.
That is, <span class="math inline">\(\pi_i = \frac{n}{N}\)</span> and <span class="math inline">\(\pi_{ij} = \frac{n}{N}\frac{n-1}{N-1}\)</span>.</p>
<p>We have that <span class="math inline">\(\hat \mu = (1/N)\sum_{i \in S} \frac{N}{n} y_i = (1/n) \sum_{i \in S} y_i\)</span> and
<span class="math inline">\(\text{Var}(\hat \mu) = (1 - \frac{n}{N})\frac{\sigma^2}{n}\)</span>.
We call <span class="math inline">\(f = \frac{n}{N}\)</span> the sampling fraction and <span class="math inline">\(1-f\)</span> the finite
population correction factor (fpc).</p>
<p>When <span class="math inline">\(n \to \infty\)</span> and <span class="math inline">\(N-n \to \infty\)</span>, we have that <span class="math inline">\(\hat \mu\)</span> is approximately normally distributed.</p>
<p>Let’s implement this in R using our own formulas:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="analyzing-surveys-with-r.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># package associated with Valliant, Devant &amp; Kreuter, includes data</span></span>
<span id="cb63-2"><a href="analyzing-surveys-with-r.html#cb63-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">&quot;PracTools&quot;</span>)</span>
<span id="cb63-3"><a href="analyzing-surveys-with-r.html#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="analyzing-surveys-with-r.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># bring data into our environment</span></span>
<span id="cb63-5"><a href="analyzing-surveys-with-r.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nhis.large)</span>
<span id="cb63-6"><a href="analyzing-surveys-with-r.html#cb63-6" aria-hidden="true" tabindex="-1"></a>nhis.large.clean <span class="ot">=</span> nhis.large <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="analyzing-surveys-with-r.html#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(educ)) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="analyzing-surveys-with-r.html#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hasdegree =</span> <span class="fu">as.numeric</span>(educ <span class="sc">&gt;</span> <span class="dv">2</span>))</span>
<span id="cb63-9"><a href="analyzing-surveys-with-r.html#cb63-9" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">nrow</span>(nhis.large.clean)</span>
<span id="cb63-10"><a href="analyzing-surveys-with-r.html#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="analyzing-surveys-with-r.html#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># draw a SRSwor of size n=300</span></span>
<span id="cb63-12"><a href="analyzing-surveys-with-r.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">310732</span>)</span>
<span id="cb63-13"><a href="analyzing-surveys-with-r.html#cb63-13" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">300</span></span>
<span id="cb63-14"><a href="analyzing-surveys-with-r.html#cb63-14" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> n<span class="sc">/</span>N</span>
<span id="cb63-15"><a href="analyzing-surveys-with-r.html#cb63-15" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="fu">sample</span>(N, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-16"><a href="analyzing-surveys-with-r.html#cb63-16" aria-hidden="true" tabindex="-1"></a>nhis.sample <span class="ot">=</span> nhis.large.clean[S, ]</span>
<span id="cb63-17"><a href="analyzing-surveys-with-r.html#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="analyzing-surveys-with-r.html#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="co"># population mean</span></span>
<span id="cb63-19"><a href="analyzing-surveys-with-r.html#cb63-19" aria-hidden="true" tabindex="-1"></a>mu_U <span class="ot">=</span> <span class="fu">mean</span>(nhis.large.clean<span class="sc">$</span>hasdegree)</span>
<span id="cb63-20"><a href="analyzing-surveys-with-r.html#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="analyzing-surveys-with-r.html#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 95% CI for the mean using survey methods</span></span>
<span id="cb63-22"><a href="analyzing-surveys-with-r.html#cb63-22" aria-hidden="true" tabindex="-1"></a>mu_hat <span class="ot">=</span> <span class="fu">mean</span>(nhis.sample<span class="sc">$</span>hasdegree)</span>
<span id="cb63-23"><a href="analyzing-surveys-with-r.html#cb63-23" aria-hidden="true" tabindex="-1"></a>SE_mu <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> f) <span class="sc">*</span> <span class="fu">sd</span>(nhis.sample<span class="sc">$</span>hasdegree)<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb63-24"><a href="analyzing-surveys-with-r.html#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(mu_hat <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> SE_mu, mu_hat <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> SE_mu)</span></code></pre></div>
<pre><code>## [1] 0.1703366 0.2629967</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="analyzing-surveys-with-r.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 95% CI using 231 methods</span></span>
<span id="cb65-2"><a href="analyzing-surveys-with-r.html#cb65-2" aria-hidden="true" tabindex="-1"></a>mu_hat <span class="ot">=</span> <span class="fu">mean</span>(nhis.sample<span class="sc">$</span>hasdegree)</span>
<span id="cb65-3"><a href="analyzing-surveys-with-r.html#cb65-3" aria-hidden="true" tabindex="-1"></a>SE_mu <span class="ot">=</span> <span class="fu">sd</span>(nhis.sample<span class="sc">$</span>hasdegree)<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb65-4"><a href="analyzing-surveys-with-r.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(mu_hat <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> SE_mu, mu_hat <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> SE_mu)  <span class="co"># pretty much identical! --&gt; why?</span></span></code></pre></div>
<pre><code>## [1] 0.1699696 0.2633638</code></pre>
<p>For more complicated designs, it will be useful to learn how to use the survey package in R:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="analyzing-surveys-with-r.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># survey package</span></span>
<span id="cb67-2"><a href="analyzing-surveys-with-r.html#cb67-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">&quot;survey&quot;</span>)</span>
<span id="cb67-3"><a href="analyzing-surveys-with-r.html#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="analyzing-surveys-with-r.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># append sampling probabilities to the data</span></span>
<span id="cb67-5"><a href="analyzing-surveys-with-r.html#cb67-5" aria-hidden="true" tabindex="-1"></a>nhis.sample <span class="ot">=</span> nhis.sample <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="analyzing-surveys-with-r.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr_incl =</span> n<span class="sc">/</span>N)</span>
<span id="cb67-7"><a href="analyzing-surveys-with-r.html#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="analyzing-surveys-with-r.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># append population size to the data</span></span>
<span id="cb67-9"><a href="analyzing-surveys-with-r.html#cb67-9" aria-hidden="true" tabindex="-1"></a>nhis.sample <span class="ot">=</span> nhis.sample <span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="analyzing-surveys-with-r.html#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N =</span> N)</span>
<span id="cb67-11"><a href="analyzing-surveys-with-r.html#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="analyzing-surveys-with-r.html#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the survey design</span></span>
<span id="cb67-13"><a href="analyzing-surveys-with-r.html#cb67-13" aria-hidden="true" tabindex="-1"></a>SRSdesign <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(</span>
<span id="cb67-14"><a href="analyzing-surveys-with-r.html#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids=</span><span class="sc">~</span><span class="dv">1</span>, <span class="co"># simple one-stage design</span></span>
<span id="cb67-15"><a href="analyzing-surveys-with-r.html#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata=</span><span class="cn">NULL</span>, <span class="co"># no strata</span></span>
<span id="cb67-16"><a href="analyzing-surveys-with-r.html#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs=</span><span class="sc">~</span>pr_incl, <span class="co"># prob = n/N</span></span>
<span id="cb67-17"><a href="analyzing-surveys-with-r.html#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>nhis.sample, <span class="co"># sample data</span></span>
<span id="cb67-18"><a href="analyzing-surveys-with-r.html#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fpc=</span><span class="sc">~</span>N) <span class="co"># population size</span></span>
<span id="cb67-19"><a href="analyzing-surveys-with-r.html#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="analyzing-surveys-with-r.html#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the mean, 95% confidence interval</span></span>
<span id="cb67-21"><a href="analyzing-surveys-with-r.html#cb67-21" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree,<span class="at">design=</span>SRSdesign)</span>
<span id="cb67-22"><a href="analyzing-surveys-with-r.html#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##               2.5 %    97.5 %
## hasdegree 0.1703375 0.2629959</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="analyzing-surveys-with-r.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you could use a t distn if you want to, but it has no theoretical backing!</span></span>
<span id="cb69-2"><a href="analyzing-surveys-with-r.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat,<span class="at">df=</span><span class="dv">199</span>)</span></code></pre></div>
<pre><code>##              2.5 %    97.5 %
## hasdegree 0.170054 0.2632793</code></pre>
<p>Let’s visualise the distribution of our estimator for different choices of <span class="math inline">\(n\)</span>.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="analyzing-surveys-with-r.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb71-2"><a href="analyzing-surveys-with-r.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">310732</span>)</span>
<span id="cb71-3"><a href="analyzing-surveys-with-r.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="analyzing-surveys-with-r.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># generate plots in 2 by 2 array</span></span>
<span id="cb71-5"><a href="analyzing-surveys-with-r.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb71-6"><a href="analyzing-surveys-with-r.html#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="analyzing-surveys-with-r.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># n = 5</span></span>
<span id="cb71-8"><a href="analyzing-surveys-with-r.html#cb71-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb71-9"><a href="analyzing-surveys-with-r.html#cb71-9" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">1000</span>)</span>
<span id="cb71-10"><a href="analyzing-surveys-with-r.html#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb71-11"><a href="analyzing-surveys-with-r.html#cb71-11" aria-hidden="true" tabindex="-1"></a>    S <span class="ot">=</span> <span class="fu">sample</span>(N, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-12"><a href="analyzing-surveys-with-r.html#cb71-12" aria-hidden="true" tabindex="-1"></a>    estimates[i] <span class="ot">=</span> <span class="fu">mean</span>(nhis.large.clean[S, ]<span class="sc">$</span>hasdegree)</span>
<span id="cb71-13"><a href="analyzing-surveys-with-r.html#cb71-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-14"><a href="analyzing-surveys-with-r.html#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(estimates, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;SRSwor, n=5, N-n=19154&quot;</span>)</span>
<span id="cb71-15"><a href="analyzing-surveys-with-r.html#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(estimates))</span>
<span id="cb71-16"><a href="analyzing-surveys-with-r.html#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="analyzing-surveys-with-r.html#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co"># n = 200</span></span>
<span id="cb71-18"><a href="analyzing-surveys-with-r.html#cb71-18" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">200</span></span>
<span id="cb71-19"><a href="analyzing-surveys-with-r.html#cb71-19" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">1000</span>)</span>
<span id="cb71-20"><a href="analyzing-surveys-with-r.html#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb71-21"><a href="analyzing-surveys-with-r.html#cb71-21" aria-hidden="true" tabindex="-1"></a>    S <span class="ot">=</span> <span class="fu">sample</span>(N, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-22"><a href="analyzing-surveys-with-r.html#cb71-22" aria-hidden="true" tabindex="-1"></a>    estimates[i] <span class="ot">=</span> <span class="fu">mean</span>(nhis.large.clean[S, ]<span class="sc">$</span>hasdegree)</span>
<span id="cb71-23"><a href="analyzing-surveys-with-r.html#cb71-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-24"><a href="analyzing-surveys-with-r.html#cb71-24" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(estimates, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;SRSwor, n=200, N-n=18959&quot;</span>)</span>
<span id="cb71-25"><a href="analyzing-surveys-with-r.html#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(estimates))</span>
<span id="cb71-26"><a href="analyzing-surveys-with-r.html#cb71-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-27"><a href="analyzing-surveys-with-r.html#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="co"># n = 500</span></span>
<span id="cb71-28"><a href="analyzing-surveys-with-r.html#cb71-28" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">500</span></span>
<span id="cb71-29"><a href="analyzing-surveys-with-r.html#cb71-29" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">1000</span>)</span>
<span id="cb71-30"><a href="analyzing-surveys-with-r.html#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb71-31"><a href="analyzing-surveys-with-r.html#cb71-31" aria-hidden="true" tabindex="-1"></a>    S <span class="ot">=</span> <span class="fu">sample</span>(N, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-32"><a href="analyzing-surveys-with-r.html#cb71-32" aria-hidden="true" tabindex="-1"></a>    estimates[i] <span class="ot">=</span> <span class="fu">mean</span>(nhis.large.clean[S, ]<span class="sc">$</span>hasdegree)</span>
<span id="cb71-33"><a href="analyzing-surveys-with-r.html#cb71-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-34"><a href="analyzing-surveys-with-r.html#cb71-34" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(estimates, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;SRSwor, n=500, N-n=18659&quot;</span>)</span>
<span id="cb71-35"><a href="analyzing-surveys-with-r.html#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(estimates))</span>
<span id="cb71-36"><a href="analyzing-surveys-with-r.html#cb71-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-37"><a href="analyzing-surveys-with-r.html#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="co"># n = 19000</span></span>
<span id="cb71-38"><a href="analyzing-surveys-with-r.html#cb71-38" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">19000</span></span>
<span id="cb71-39"><a href="analyzing-surveys-with-r.html#cb71-39" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">1000</span>)</span>
<span id="cb71-40"><a href="analyzing-surveys-with-r.html#cb71-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb71-41"><a href="analyzing-surveys-with-r.html#cb71-41" aria-hidden="true" tabindex="-1"></a>    S <span class="ot">=</span> <span class="fu">sample</span>(N, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-42"><a href="analyzing-surveys-with-r.html#cb71-42" aria-hidden="true" tabindex="-1"></a>    estimates[i] <span class="ot">=</span> <span class="fu">mean</span>(nhis.large.clean[S, ]<span class="sc">$</span>hasdegree)</span>
<span id="cb71-43"><a href="analyzing-surveys-with-r.html#cb71-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-44"><a href="analyzing-surveys-with-r.html#cb71-44" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(estimates, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;SRSwor, n=19100, N-n=59&quot;</span>)</span>
<span id="cb71-45"><a href="analyzing-surveys-with-r.html#cb71-45" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(estimates))</span></code></pre></div>
<p><img src="figs/unnamed-chunk-19.png" width="672" /></p>
</div>
<div id="stratified-simple-random-sampling-without-replacement-ssrswor" class="section level3 hasAnchor" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Stratified Simple Random Sampling Without Replacement (SSRSwor)<a href="analyzing-surveys-with-r.html#stratified-simple-random-sampling-without-replacement-ssrswor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Imagine we have <span class="math inline">\(H\)</span> strata (e.g. provinces) indexed by <span class="math inline">\(h\)</span>. In each stratum,
there is a population <span class="math inline">\(N_h\)</span>, such that <span class="math inline">\(N = \sum_{h=1}^H N_h\)</span>. We conduct a
SRSwor of size <span class="math inline">\(n_h\)</span> in each stratum.</p>
<p>Then, the inclusion probability for an individual in stratum <span class="math inline">\(h\)</span> is <span class="math inline">\(\pi_i^h = \frac{n_h}{N_h}\)</span>.
The joint inclusion probability for two individuals in stratum <span class="math inline">\(h\)</span> is <span class="math inline">\(\pi_{ij}^h = \frac{n_h}{N_h}\frac{n_h-1}{N_h-1}\)</span>. The joint inclusion probability for two individuals in <em>different</em> strata is <span class="math inline">\(\pi_{ij}^{hh&#39;} = \frac{n_h}{N_h} \frac{n_{h&#39;}}{N_{h&#39;}}\)</span>.</p>
<p>We have that <span class="math inline">\(\hat \mu = \sum_{h=1}^H \frac{N_h}{N} \hat \mu_h\)</span> where <span class="math inline">\(\hat \mu_h\)</span>
is the SRSwor estimator within each stratum.</p>
<p>Furthermore, <span class="math inline">\(\text{Var}(\hat \mu) = \sum\limits_{h=1}^H \left(\frac{N_h}{N}\right)^2 (1-f_h) \frac{\sigma^2_h}{n_h}\)</span>.</p>
<p>In R, let’s simulate a stratified simple random sample:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="analyzing-surveys-with-r.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we want to stratify by race</span></span>
<span id="cb72-2"><a href="analyzing-surveys-with-r.html#cb72-2" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">=</span> <span class="fu">table</span>(nhis.large.clean<span class="sc">$</span>race)</span>
<span id="cb72-3"><a href="analyzing-surveys-with-r.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="analyzing-surveys-with-r.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># want to obtain estimates by subgroup: oversample the smaller groups</span></span>
<span id="cb72-5"><a href="analyzing-surveys-with-r.html#cb72-5" aria-hidden="true" tabindex="-1"></a>n_h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span>, <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span>)</span>
<span id="cb72-6"><a href="analyzing-surveys-with-r.html#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="analyzing-surveys-with-r.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># sampling fractions by stratum</span></span>
<span id="cb72-8"><a href="analyzing-surveys-with-r.html#cb72-8" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> n_h<span class="sc">/</span>N_h</span>
<span id="cb72-9"><a href="analyzing-surveys-with-r.html#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="analyzing-surveys-with-r.html#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># draw a SSRSwor</span></span>
<span id="cb72-11"><a href="analyzing-surveys-with-r.html#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">87876</span>)</span>
<span id="cb72-12"><a href="analyzing-surveys-with-r.html#cb72-12" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">stratsample</span>(<span class="at">strata =</span> nhis.large.clean<span class="sc">$</span>race, <span class="at">counts =</span> n_h)</span>
<span id="cb72-13"><a href="analyzing-surveys-with-r.html#cb72-13" aria-hidden="true" tabindex="-1"></a>nhis.sample <span class="ot">=</span> nhis.large.clean[S, ]</span></code></pre></div>
<p>Now we estimate:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="analyzing-surveys-with-r.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># append sampling probabilities to the data</span></span>
<span id="cb73-2"><a href="analyzing-surveys-with-r.html#cb73-2" aria-hidden="true" tabindex="-1"></a>nhis.sample <span class="ot">=</span> nhis.sample <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="analyzing-surveys-with-r.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr_incl =</span> f[race])</span>
<span id="cb73-4"><a href="analyzing-surveys-with-r.html#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="analyzing-surveys-with-r.html#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co"># append population size to the data</span></span>
<span id="cb73-6"><a href="analyzing-surveys-with-r.html#cb73-6" aria-hidden="true" tabindex="-1"></a>nhis.sample <span class="ot">=</span> nhis.sample <span class="sc">%&gt;%</span></span>
<span id="cb73-7"><a href="analyzing-surveys-with-r.html#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N =</span> N_h[race])</span>
<span id="cb73-8"><a href="analyzing-surveys-with-r.html#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="analyzing-surveys-with-r.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the survey design</span></span>
<span id="cb73-10"><a href="analyzing-surveys-with-r.html#cb73-10" aria-hidden="true" tabindex="-1"></a>SSRSdesign <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(</span>
<span id="cb73-11"><a href="analyzing-surveys-with-r.html#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids=</span><span class="sc">~</span><span class="dv">1</span>, <span class="co"># simple one-stage design</span></span>
<span id="cb73-12"><a href="analyzing-surveys-with-r.html#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata=</span><span class="sc">~</span>race, <span class="co"># stratify by race</span></span>
<span id="cb73-13"><a href="analyzing-surveys-with-r.html#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs=</span><span class="sc">~</span>pr_incl, <span class="co"># prob = n/N</span></span>
<span id="cb73-14"><a href="analyzing-surveys-with-r.html#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>nhis.sample, <span class="co"># sample data</span></span>
<span id="cb73-15"><a href="analyzing-surveys-with-r.html#cb73-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">fpc=</span><span class="sc">~</span>N) <span class="co"># population size</span></span>
<span id="cb73-16"><a href="analyzing-surveys-with-r.html#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="analyzing-surveys-with-r.html#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the mean, 95% confidence interval</span></span>
<span id="cb73-18"><a href="analyzing-surveys-with-r.html#cb73-18" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree,<span class="at">design=</span>SSRSdesign); muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.14919 0.0293</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="analyzing-surveys-with-r.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##                2.5 %    97.5 %
## hasdegree 0.09170761 0.2066743</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="analyzing-surveys-with-r.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean by race</span></span>
<span id="cb77-2"><a href="analyzing-surveys-with-r.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>hasdegree,<span class="at">by=</span><span class="sc">~</span>race,<span class="at">FUN=</span>svymean,</span>
<span id="cb77-3"><a href="analyzing-surveys-with-r.html#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">design=</span>SSRSdesign)</span></code></pre></div>
<pre><code>##   race hasdegree         se
## 1    1      0.15 0.03577108
## 2    2      0.10 0.02961191
## 3    3      0.30 0.04321784</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="analyzing-surveys-with-r.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare with unstratified design</span></span>
<span id="cb79-2"><a href="analyzing-surveys-with-r.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>hasdegree,<span class="at">by=</span><span class="sc">~</span>race,<span class="at">FUN=</span>svymean,</span>
<span id="cb79-3"><a href="analyzing-surveys-with-r.html#cb79-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">design=</span>SRSdesign)</span></code></pre></div>
<pre><code>##   race hasdegree         se
## 1    1 0.2280702 0.02761555
## 2    2 0.1071429 0.04107490
## 3    3 0.4375000 0.12325037</code></pre>
</div>
</div>
<div id="post-adjustment-model-assisted" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Post-adjustment (model-assisted)<a href="analyzing-surveys-with-r.html#post-adjustment-model-assisted" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s say we’ve conducted our survey and have our estimate
<span class="math inline">\(\hat \mu = (1/N) \sum_{i \in S} (1/\pi_i) y_i\)</span>. Now we ask,
<em>Can we use information we know about the population to “improve”
our estimate?</em></p>
<p>In other words, we want to consider a “post-adjustment” to the inverse probability weights
so that <span class="math inline">\(w_i = (1/\pi_i) \theta_i\)</span>. To do this we want to incorporate auxiliary
information <span class="math inline">\(X_i\)</span> that we know about each individual <span class="math inline">\(i\)</span>, for which we also
have information about the population.</p>
<div id="post-stratification" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Post-stratification<a href="analyzing-surveys-with-r.html#post-stratification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For example, consider the HT estimator for stratification:</p>
<p><span class="math display">\[
\hat \mu = \sum_{h=1}^H \frac{N_h}{N} \hat \mu_h
\]</span></p>
<p>Even if we did not stratify in our sampling design, it makes intuitive sense
to use this type of estimator after the fact. For example, perhaps we were not
able to stratify based on age group, but we asked individuals’ age on the survey.
Using information from the census, we can thus “post”-stratify <span class="citation">(Valliant 1993)</span> our sample based on age group.
Let’s call this estimator <span class="math inline">\(\hat \mu_{\text{PS}}\)</span></p>
<p><span class="math display">\[
\hat \mu_{\text{PS}} = \sum_{h=1}^H \frac{N_h}{N} \hat \mu_{h,\text{PS}}
\]</span>
where <span class="math inline">\(\hat \mu_{h,\text{PS}} = \frac{1}{N_h} \sum\limits_{i \in S} I(i \in U_h)\dfrac{N_h}{\widetilde{n_h}} y_i\)</span>.</p>
<p>There is one key difference: in SSRSwor, the researcher chose the sample size <span class="math inline">\(n_h\)</span>
within each stratum. Here, the researcher does NOT know the sample size until the sample
is taken. In other words, <span class="math inline">\(\widetilde{n_h}\)</span> is a <em>random variable</em>!</p>
<p>Thus, <span class="math inline">\(\hat \mu_{h,\text{PS}}\)</span> is not the nice linear estimator we had before.
We no longer have a simple closed formula for the variance of the estimator.
Now we must take a different strategy:</p>
<ul>
<li>taylor approximation: equivalent to using the variance formula for an SSRSwor.
This would tend to slightly underestimate the variance, because we do not take into account variability from <span class="math inline">\(\widetilde{n_h}\)</span>.</li>
<li>resampling methods, e.g. bootstrap</li>
</ul>
<p>Let’s take our SRS sample and post-stratify it based on race:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="analyzing-surveys-with-r.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect population counts in format needed for postStratify</span></span>
<span id="cb81-2"><a href="analyzing-surveys-with-r.html#cb81-2" aria-hidden="true" tabindex="-1"></a>popcounts <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">race=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb81-3"><a href="analyzing-surveys-with-r.html#cb81-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Freq=</span><span class="fu">as.numeric</span>(<span class="fu">table</span>(nhis.large.clean<span class="sc">$</span>race)))</span>
<span id="cb81-4"><a href="analyzing-surveys-with-r.html#cb81-4" aria-hidden="true" tabindex="-1"></a>PSdesign <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">postStratify</span>(</span>
<span id="cb81-5"><a href="analyzing-surveys-with-r.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">design=</span>SRSdesign, <span class="co"># the initial design</span></span>
<span id="cb81-6"><a href="analyzing-surveys-with-r.html#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata=</span><span class="sc">~</span>race,     <span class="co"># the variable we post-stratify on</span></span>
<span id="cb81-7"><a href="analyzing-surveys-with-r.html#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">population=</span>popcounts)   <span class="co"># population counts</span></span></code></pre></div>
<p>Compare SRS with post-stratified SRS:
We see a small adjustment in the overall estimate and standard error:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="analyzing-surveys-with-r.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate of overall mean</span></span>
<span id="cb82-2"><a href="analyzing-surveys-with-r.html#cb82-2" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> SRSdesign)</span>
<span id="cb82-3"><a href="analyzing-surveys-with-r.html#cb82-3" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.21667 0.0236</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="analyzing-surveys-with-r.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##               2.5 %    97.5 %
## hasdegree 0.1703375 0.2629959</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="analyzing-surveys-with-r.html#cb86-1" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> PSdesign)</span>
<span id="cb86-2"><a href="analyzing-surveys-with-r.html#cb86-2" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.21941 0.0238</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="analyzing-surveys-with-r.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##               2.5 %    97.5 %
## hasdegree 0.1728354 0.2659927</code></pre>
<p>Compare SSRS with post-stratified SRS estimates by race: We see that
post-stratification is really only a tool to get “better” <em>overall</em> estimates.
Post-stratification still doesn’t let us get better estimates within-stratum.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="analyzing-surveys-with-r.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate by race</span></span>
<span id="cb90-2"><a href="analyzing-surveys-with-r.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>hasdegree, <span class="at">by =</span> <span class="sc">~</span>race, <span class="at">FUN =</span> svymean, <span class="at">design =</span> SSRSdesign)</span></code></pre></div>
<pre><code>##   race hasdegree         se
## 1    1      0.15 0.03577108
## 2    2      0.10 0.02961191
## 3    3      0.30 0.04321784</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="analyzing-surveys-with-r.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>hasdegree, <span class="at">by =</span> <span class="sc">~</span>race, <span class="at">FUN =</span> svymean, <span class="at">design =</span> PSdesign)</span></code></pre></div>
<pre><code>##   race hasdegree         se
## 1    1 0.2280702 0.02761555
## 2    2 0.1071429 0.04107490
## 3    3 0.4375000 0.12325037</code></pre>
</div>
<div id="calibration-dealing-with-multiple-auxilliary-variables" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Calibration: Dealing with multiple auxilliary variables<a href="analyzing-surveys-with-r.html#calibration-dealing-with-multiple-auxilliary-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s say we want to post-adjust our estimate on race, but also on gender and age group?
In order to use post-stratification, we need to know the entire 3-way table of population
counts. For example, we need to know how many white men aged 55+ there are in the population.</p>
<p>We can use other calibration techniques (which post-stratification can be considered
a general case of) like <em>raking</em> that rely only one <em>one-way</em> tabulations.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="analyzing-surveys-with-r.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define population totals for each raking variable</span></span>
<span id="cb94-2"><a href="analyzing-surveys-with-r.html#cb94-2" aria-hidden="true" tabindex="-1"></a>pop.sex <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sex =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">Freq =</span> <span class="fu">as.numeric</span>(<span class="fu">table</span>(nhis.large.clean<span class="sc">$</span>sex)))</span>
<span id="cb94-3"><a href="analyzing-surveys-with-r.html#cb94-3" aria-hidden="true" tabindex="-1"></a>pop.age.grp <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">age.grp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="at">Freq =</span> <span class="fu">as.numeric</span>(<span class="fu">table</span>(nhis.large.clean<span class="sc">$</span>age.grp)))</span>
<span id="cb94-4"><a href="analyzing-surveys-with-r.html#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="analyzing-surveys-with-r.html#cb94-5" aria-hidden="true" tabindex="-1"></a>rakedesign <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">rake</span>(<span class="at">design =</span> SSRSdesign, <span class="at">sample.margins =</span> <span class="fu">list</span>(<span class="sc">~</span>sex,</span>
<span id="cb94-6"><a href="analyzing-surveys-with-r.html#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>age.grp), <span class="at">population.margins =</span> <span class="fu">list</span>(pop.sex, pop.age.grp))</span>
<span id="cb94-7"><a href="analyzing-surveys-with-r.html#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="analyzing-surveys-with-r.html#cb94-8" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> SSRSdesign)</span>
<span id="cb94-9"><a href="analyzing-surveys-with-r.html#cb94-9" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.14919 0.0293</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="analyzing-surveys-with-r.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##                2.5 %    97.5 %
## hasdegree 0.09170761 0.2066743</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="analyzing-surveys-with-r.html#cb98-1" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> rakedesign)</span>
<span id="cb98-2"><a href="analyzing-surveys-with-r.html#cb98-2" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.15249 0.0298</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="analyzing-surveys-with-r.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##                2.5 %    97.5 %
## hasdegree 0.09410781 0.2108778</code></pre>
</div>
<div id="what-makes-a-good-calibration-variable" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> What makes a good calibration variable?<a href="analyzing-surveys-with-r.html#what-makes-a-good-calibration-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>E.g. see <span class="citation">(Lundy and Rao 2022)</span>.</p>
</div>
<div id="variance-estimation-resampling" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Variance Estimation: Resampling<a href="analyzing-surveys-with-r.html#variance-estimation-resampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s see how the bootstrap version of post-stratification:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="analyzing-surveys-with-r.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start with bootsrapped SRS</span></span>
<span id="cb102-2"><a href="analyzing-surveys-with-r.html#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1902</span>)</span>
<span id="cb102-3"><a href="analyzing-surveys-with-r.html#cb102-3" aria-hidden="true" tabindex="-1"></a>bootstrapSRS <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">as.svrepdesign</span>(<span class="at">design =</span> SRSdesign, <span class="at">type =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb102-4"><a href="analyzing-surveys-with-r.html#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">replicates =</span> <span class="dv">5000</span>)</span>
<span id="cb102-5"><a href="analyzing-surveys-with-r.html#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="analyzing-surveys-with-r.html#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply post-stratification to every replicate weight</span></span>
<span id="cb102-7"><a href="analyzing-surveys-with-r.html#cb102-7" aria-hidden="true" tabindex="-1"></a>bootstrapPS <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">postStratify</span>(<span class="at">design =</span> bootstrapSRS, <span class="at">strata =</span> <span class="sc">~</span>race,</span>
<span id="cb102-8"><a href="analyzing-surveys-with-r.html#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> popcounts)</span>
<span id="cb102-9"><a href="analyzing-surveys-with-r.html#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="analyzing-surveys-with-r.html#cb102-10" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> PSdesign)</span>
<span id="cb102-11"><a href="analyzing-surveys-with-r.html#cb102-11" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.21941 0.0238</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="analyzing-surveys-with-r.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##               2.5 %    97.5 %
## hasdegree 0.1728354 0.2659927</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="analyzing-surveys-with-r.html#cb106-1" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> bootstrapPS)</span>
<span id="cb106-2"><a href="analyzing-surveys-with-r.html#cb106-2" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.21941 0.0242</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="analyzing-surveys-with-r.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##               2.5 %    97.5 %
## hasdegree 0.1719077 0.2669204</code></pre>
<p>How about the raking estimate:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="analyzing-surveys-with-r.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start with bootstrap replicated SSRS</span></span>
<span id="cb110-2"><a href="analyzing-surveys-with-r.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">76573</span>)</span>
<span id="cb110-3"><a href="analyzing-surveys-with-r.html#cb110-3" aria-hidden="true" tabindex="-1"></a>bootstrapSSRS <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">as.svrepdesign</span>(<span class="at">design =</span> SSRSdesign, <span class="at">type =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb110-4"><a href="analyzing-surveys-with-r.html#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">replicates =</span> <span class="dv">5000</span>)</span>
<span id="cb110-5"><a href="analyzing-surveys-with-r.html#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="analyzing-surveys-with-r.html#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rake each bootstrap replicate</span></span>
<span id="cb110-7"><a href="analyzing-surveys-with-r.html#cb110-7" aria-hidden="true" tabindex="-1"></a>bootrakedesign <span class="ot">=</span> survey<span class="sc">::</span><span class="fu">rake</span>(<span class="at">design =</span> bootstrapSSRS, <span class="at">sample.margins =</span> <span class="fu">list</span>(<span class="sc">~</span>sex,</span>
<span id="cb110-8"><a href="analyzing-surveys-with-r.html#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>age.grp), <span class="at">population.margins =</span> <span class="fu">list</span>(pop.sex, pop.age.grp))</span>
<span id="cb110-9"><a href="analyzing-surveys-with-r.html#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="analyzing-surveys-with-r.html#cb110-10" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> SSRSdesign)</span>
<span id="cb110-11"><a href="analyzing-surveys-with-r.html#cb110-11" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.14919 0.0293</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="analyzing-surveys-with-r.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##                2.5 %    97.5 %
## hasdegree 0.09170761 0.2066743</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="analyzing-surveys-with-r.html#cb114-1" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> rakedesign)</span>
<span id="cb114-2"><a href="analyzing-surveys-with-r.html#cb114-2" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.15249 0.0298</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="analyzing-surveys-with-r.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##                2.5 %    97.5 %
## hasdegree 0.09410781 0.2108778</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="analyzing-surveys-with-r.html#cb118-1" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> bootrakedesign)</span>
<span id="cb118-2"><a href="analyzing-surveys-with-r.html#cb118-2" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##              mean     SE
## hasdegree 0.15249 0.0299</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="analyzing-surveys-with-r.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(muhat)</span></code></pre></div>
<pre><code>##                2.5 %    97.5 %
## hasdegree 0.09383431 0.2111513</code></pre>
<p>We can ask the svy commands to produce all replicates of the estimate.
Doing this we can get confidence intervals based on the actual distribution
of the estimates.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="analyzing-surveys-with-r.html#cb122-1" aria-hidden="true" tabindex="-1"></a>allmus <span class="ot">=</span> <span class="fu">svymean</span>(<span class="sc">~</span>hasdegree, <span class="at">design =</span> bootrakedesign, <span class="at">return.replicates =</span> <span class="cn">TRUE</span>)</span>
<span id="cb122-2"><a href="analyzing-surveys-with-r.html#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(allmus<span class="sc">$</span>replicates)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-27.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="analyzing-surveys-with-r.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(allmus<span class="sc">$</span>replicates, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##       2.5%      97.5% 
## 0.09744063 0.21383397</code></pre>
</div>
</div>
<div id="non-probability-surveys-model-based" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Non-probability Surveys (model-based)<a href="analyzing-surveys-with-r.html#non-probability-surveys-model-based" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Previously we started with a survey design (design-based approach),
and then possibly made adjustments to the design weights in order
to “improve” our estimates. In a non-probability survey context
(or probability survey with non-response), we no longer have a proper design.
That is, we no longer have full information about the inclusion probabilities
<span class="math inline">\(\pi_i\)</span>.</p>
<p>A review of inference in non-probability samples can be found in <span class="citation">(Elliott and Valliant 2017)</span>. To summarise, we can take the same thought process
as before. Namely, we have our mean estimate <span class="math inline">\(\hat \mu = \sum_{i \in S} \frac{1}{\gamma_i}y_i\)</span> where <span class="math inline">\(\gamma_i\)</span> is our “pseudo-inclusion probability”.</p>
<p>That is, we think of it as <span class="math inline">\(\gamma_i = \Pr(i \text{ joins our survey})\)</span>.
However, we no longer have any degree of control over this.
For instance, <span class="math inline">\(i\)</span> joining our survey could include the following steps:</p>
<ul>
<li><span class="math inline">\(i\)</span> has access to the internet</li>
<li><span class="math inline">\(i\)</span> volunteers for our opt-in survey panel conditional on having access to the internet</li>
<li><span class="math inline">\(i\)</span> is sampled from the panel given they belong to the panel</li>
<li><span class="math inline">\(i\)</span> responds to our survey given we sampled them from the panel</li>
</ul>
<p>We must assume that each step has some <em>non-zero</em> probability of occurring.
Furthermore, we must assume that these probabilities rely only on some variables
<span class="math inline">\(X\)</span> which we <em>observe in both the sample and the population.</em></p>
<p>That is we estimate using <span class="math inline">\(\hat \mu (X) = \sum_{i \in S} w_i(x_i; \beta) y_i\)</span>
where <span class="math inline">\(w_i(x_i; \beta)\)</span> is our “psuedo-weight” which can be computed using
calibration methods discussed above.</p>
<p>This has direct parallels with causal analysis: if we don’t have a properly
randomized experiment, then we attempt to make the treatment and control
groups as “similar” as possible (using inverse probabliity weighting, propensity scores,
matching, etc.) such that any difference that remains must
be due to the treatment. However, this relies on the assumption that
we have selection only on the observables <span class="math inline">\(X\)</span>!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="smoothing-techniques.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-causal-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/uwswagclub/workshop-bookdown/edit/master/06-surveys.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/uwswagclub/workshop-bookdown/blob/master/06-surveys.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
